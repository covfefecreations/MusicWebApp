<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BeatGrid ‚Äî Studio Edition</title>

  <!-- Tailwind CDN + custom theme -->
  <script>
    tailwind = { config: {
      theme: {
        extend: {
          colors: {
            studio: {
              50: '#fbfbfc', 100:'#f7f7f8', 200:'#efeff1', 300:'#dfe0e3',
              400:'#bfc2c8', 500:'#97a0a8', 600:'#6f7b83', 700:'#445055',
              800:'#2b3438', 900:'#0f1416'
            },
            accent: { DEFAULT: '#6ee7b7', 600: '#34d399' },
            glow: '#e6fffa'
          },
          boxShadow: {
            'studio-soft': '0 6px 30px rgba(2,6,23,0.45)'
          },
          fontFamily: {
            display: ['Inter', 'sans-serif'],
            body: ['Inter', 'sans-serif']
          }
        }
      }
    } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tone.js audio library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

  <style>
    :root{color-scheme: dark}
    body{background:linear-gradient(180deg,#071019 0%,#0a1116 100%);font-family:Inter,system-ui,-apple-system;min-height:100vh}

    .card {
      background: linear-gradient(135deg, rgba(255,255,255,0.025), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow:0 8px 32px rgba(2,6,23,0.7);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(8px);
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(2,6,23,0.8), 0 0 0 1px rgba(110,231,183,0.1);
      border-color: rgba(110,231,183,0.15);
    }

    /* Category choice buttons */
    .category-btn {
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 2px solid rgba(255,255,255,0.08);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .category-btn:hover {
      transform: translateY(-4px) scale(1.02);
      border-color: rgba(110,231,183,0.4);
      background: linear-gradient(135deg, rgba(110,231,183,0.08), rgba(110,231,183,0.03));
      box-shadow: 0 12px 40px rgba(110,231,183,0.2);
    }

    /* Slot cards */
    .slot-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 2px dashed rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    .slot-card.filled {
      border-style: solid;
      border-color: rgba(110,231,183,0.3);
      background: linear-gradient(135deg, rgba(110,231,183,0.05), rgba(110,231,183,0.02));
    }
    .slot-card.empty:hover {
      border-color: rgba(110,231,183,0.3);
      background: rgba(110,231,183,0.02);
    }

    /* Pattern selection cards */
    .pattern-card {
      cursor: pointer;
      background: linear-gradient(135deg, rgba(255,255,255,0.025), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.06);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .pattern-card:hover {
      transform: translateY(-3px);
      border-color: rgba(110,231,183,0.3);
      box-shadow: 0 8px 24px rgba(110,231,183,0.15);
    }
    .pattern-card.selected {
      border-color: rgba(110,231,183,0.6);
      background: linear-gradient(135deg, rgba(110,231,183,0.1), rgba(110,231,183,0.05));
      box-shadow: 0 8px 32px rgba(110,231,183,0.25);
    }

    /* Step grid */
    .step {
      width:100%;
      padding-top:100%;
      position:relative;
      border-radius:4px;
      background:rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .step.on {
      background: linear-gradient(135deg,#6ee7b7,#34d399);
      box-shadow:0 2px 8px rgba(46,185,128,0.2);
      border-color: rgba(110,231,183,0.4);
    }

    /* Progress dots */
    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transition: all 0.3s ease;
    }
    .progress-dot.active {
      background: linear-gradient(135deg, #6ee7b7, #34d399);
      box-shadow: 0 0 12px rgba(110,231,183,0.5);
      transform: scale(1.3);
    }
    .progress-dot.completed {
      background: rgba(110,231,183,0.6);
    }

    .muted{ color:#9fb1b0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:12px }

    /* View transitions */
    .view {
      display: none;
      animation: fadeIn 0.4s ease-out;
    }
    .view.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Range slider */
    input[type="range"] {
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      height: 6px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ee7b7, #34d399);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(110,231,183,0.3);
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ee7b7, #34d399);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(110,231,183,0.3);
    }

    button {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    button:active:not(:disabled) {
      transform: translateY(0);
    }
  </style>
</head>
<body class="text-studio-100">

  <!-- Header -->
  <header class="p-4 lg:p-6 border-b border-studio-700/20">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 flex items-center justify-center">
          <svg viewBox="0 0 48 48" class="w-8 h-8" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" r="10" stroke="#6ee7b7" stroke-width="1.5" opacity="0.95"/>
            <circle cx="24" cy="24" r="16" stroke="#34d399" stroke-width="1.2" opacity="0.7"/>
            <circle cx="24" cy="24" r="22" stroke="#a7f3d0" stroke-width="0.9" opacity="0.45"/>
          </svg>
        </div>
        <div>
          <div class="text-lg font-semibold tracking-tight">BeatGrid</div>
          <div class="text-xs muted hidden sm:block">Studio Edition</div>
        </div>
      </div>
      <button id="resetBtn" class="px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">
        Start Over
      </button>
    </div>
  </header>

  <main class="p-4 lg:p-8 max-w-6xl mx-auto">

    <!-- VIEW 1: Start Screen -->
    <div id="startView" class="view active">
      <div class="min-h-[70vh] flex flex-col items-center justify-center">
        <div class="text-center mb-12">
          <h1 class="text-3xl md:text-4xl font-bold mb-3">Build Your Beat</h1>
          <p class="text-lg muted">What do you want to start with?</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-3xl">
          <!-- Drums -->
          <button data-category="drum" class="category-btn p-8 rounded-2xl text-center">
            <div class="text-5xl mb-4">ü•Å</div>
            <div class="text-xl font-semibold mb-2">Drums</div>
            <div class="text-sm muted">Start with rhythm</div>
          </button>

          <!-- Bass -->
          <button data-category="bass" class="category-btn p-8 rounded-2xl text-center">
            <div class="text-5xl mb-4">üé∏</div>
            <div class="text-xl font-semibold mb-2">Bass</div>
            <div class="text-sm muted">Start with harmony</div>
          </button>

          <!-- Lead -->
          <button data-category="lead" class="category-btn p-8 rounded-2xl text-center">
            <div class="text-5xl mb-4">üéπ</div>
            <div class="text-xl font-semibold mb-2">Lead</div>
            <div class="text-sm muted">Start with melody</div>
          </button>
        </div>
      </div>
    </div>

    <!-- VIEW 2: Pattern Selection -->
    <div id="selectionView" class="view">
      <!-- Progress indicator -->
      <div class="flex items-center justify-center gap-3 mb-8">
        <div class="progress-dot" data-step="0"></div>
        <div class="progress-dot" data-step="1"></div>
        <div class="progress-dot" data-step="2"></div>
      </div>

      <!-- Selection header -->
      <div class="text-center mb-8">
        <h2 class="text-2xl md:text-3xl font-bold mb-2" id="selectionTitle">Choose your pattern</h2>
        <p class="text-sm muted" id="selectionSubtitle">Step 1 of 3</p>
      </div>

      <!-- Pattern grid -->
      <div id="patternGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
        <!-- Patterns will be inserted here -->
      </div>

      <!-- Navigation buttons -->
      <div class="flex items-center justify-between mt-8">
        <button id="backBtn" class="px-6 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 hover:bg-studio-800/70 disabled:opacity-50 disabled:cursor-not-allowed">
          ‚Üê Back
        </button>
        <button id="continueBtn" class="px-6 py-3 rounded-lg bg-accent border border-accent text-studio-900 font-semibold hover:bg-accent-600 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          Continue ‚Üí
        </button>
      </div>
    </div>

    <!-- VIEW 3: Composition Studio -->
    <div id="compositionView" class="view">
      <div class="text-center mb-8">
        <h2 class="text-2xl md:text-3xl font-bold mb-2">Your Composition</h2>
        <p class="text-sm muted">Loop ‚Ä¢ Listen ‚Ä¢ Recalibrate</p>
      </div>

      <!-- Slot cards -->
      <div class="space-y-4 max-w-3xl mx-auto mb-8">
        <!-- Drum Slot -->
        <div id="drumSlot" class="slot-card empty rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="text-3xl">ü•Å</div>
              <div>
                <div class="font-semibold">Drum Slot</div>
                <div class="text-xs muted">Rhythm foundation</div>
              </div>
            </div>
            <button data-action="change" data-slot="drum" class="slot-change-btn hidden px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">
              Change
            </button>
          </div>
          <div class="slot-content">
            <button data-slot="drum" class="slot-add-btn w-full py-8 border-2 border-dashed border-studio-700/30 rounded-lg hover:border-accent/30 hover:bg-accent/5 transition-all">
              <div class="text-accent text-lg">+ Add Drum Pattern</div>
            </button>
          </div>
        </div>

        <!-- Bass Slot -->
        <div id="bassSlot" class="slot-card empty rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="text-3xl">üé∏</div>
              <div>
                <div class="font-semibold">Bass Slot</div>
                <div class="text-xs muted">Harmonic progression</div>
              </div>
            </div>
            <button data-action="change" data-slot="bass" class="slot-change-btn hidden px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">
              Change
            </button>
          </div>
          <div class="slot-content">
            <button data-slot="bass" class="slot-add-btn w-full py-8 border-2 border-dashed border-studio-700/30 rounded-lg hover:border-accent/30 hover:bg-accent/5 transition-all">
              <div class="text-accent text-lg">+ Add Bass Pattern</div>
            </button>
          </div>
        </div>

        <!-- Lead Slot -->
        <div id="leadSlot" class="slot-card empty rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="text-3xl">üéπ</div>
              <div>
                <div class="font-semibold">Lead Slot</div>
                <div class="text-xs muted">Melodic motif</div>
              </div>
            </div>
            <button data-action="change" data-slot="lead" class="slot-change-btn hidden px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">
              Change
            </button>
          </div>
          <div class="slot-content">
            <button data-slot="lead" class="slot-add-btn w-full py-8 border-2 border-dashed border-studio-700/30 rounded-lg hover:border-accent/30 hover:bg-accent/5 transition-all">
              <div class="text-accent text-lg">+ Add Lead Pattern</div>
            </button>
          </div>
        </div>
      </div>

      <!-- Playback Controls -->
      <div class="max-w-3xl mx-auto card rounded-xl p-6 mb-6">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
          <div class="flex items-center gap-3">
            <button id="playBtn" class="px-6 py-3 rounded-lg bg-accent border border-accent text-studio-900 font-semibold hover:bg-accent-600 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              ‚ñ∂ Play
            </button>
            <button id="stopBtn" class="px-6 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 hover:bg-studio-800/70 disabled:opacity-50" disabled>
              ‚ñ† Stop
            </button>
          </div>
          <div class="flex items-center gap-3">
            <div class="text-sm muted">Tempo</div>
            <div class="font-semibold" id="tempoLabel">170 BPM</div>
            <input id="tempo" type="range" min="160" max="180" value="170" class="w-32" />
          </div>
        </div>
      </div>

      <!-- Export Section -->
      <div class="max-w-3xl mx-auto">
        <div class="text-center mb-4">
          <button id="exportMenuBtn" class="px-6 py-3 rounded-lg bg-accent/10 border border-accent/30 text-accent hover:bg-accent/20 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Export Options ‚ñº
          </button>
        </div>
        <div id="exportMenu" class="hidden card rounded-xl p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <button id="copySelection" class="px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm hover:bg-studio-800/70 hover:text-accent transition-colors text-left">
              üìã Copy as LLM Format
            </button>
            <button id="downloadSelection" class="px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm hover:bg-studio-800/70 hover:text-accent transition-colors text-left">
              üíæ Download as JSON
            </button>
            <button id="exportAll" class="px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm hover:bg-studio-800/70 hover:text-accent transition-colors text-left">
              üì¶ Export All Patterns
            </button>
            <button id="saveGist" class="px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm hover:bg-studio-800/70 transition-colors text-left">
              üîó Save to GitHub Gist
            </button>
          </div>
        </div>
      </div>
    </div>

  </main>

  <!-- JS modules -->
  <script type="module">
    import { drums, basses, leads } from './js/data.js';
    import { icons } from './js/icons.js';
    import { renderApp } from './js/app.js';

    renderApp({ drums, basses, leads, icons });
  </script>
</body>
</html>
