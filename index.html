<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BeatGrid — Studio Edition</title>

  <!-- Tailwind CDN + custom theme -->
  <script>
    // Tailwind quick config (studio aesthetic)
    tailwind = { config: {
      theme: {
        extend: {
          colors: {
            studio: {
              50: '#fbfbfc', 100:'#f7f7f8', 200:'#efeff1', 300:'#dfe0e3',
              400:'#bfc2c8', 500:'#97a0a8', 600:'#6f7b83', 700:'#445055',
              800:'#2b3438', 900:'#0f1416'
            },
            accent: { DEFAULT: '#6ee7b7', 600: '#34d399' },
            glow: '#e6fffa'
          },
          boxShadow: {
            'studio-soft': '0 6px 30px rgba(2,6,23,0.45)'
          },
          fontFamily: {
            display: ['Inter', 'sans-serif'],
            body: ['Inter', 'sans-serif']
          }
        }
      }
    } }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tone.js audio library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

  <!-- small custom styles -->
  <style>
    :root{color-scheme: dark}
    body{background:linear-gradient(180deg,#071019 0%,#0a1116 100%);font-family:Inter,system-ui,-apple-system}

    /* Enhanced card styling with smooth transitions */
    .card {
      background: linear-gradient(135deg, rgba(255,255,255,0.025), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow:0 8px 32px rgba(2,6,23,0.7);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(8px);
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(2,6,23,0.8), 0 0 0 1px rgba(110,231,183,0.1);
      border-color: rgba(110,231,183,0.15);
    }

    /* Step sequencer grid with enhanced visual feedback */
    .step {
      width:100%;
      padding-top:100%;
      position:relative;
      border-radius:6px;
      background:rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.05);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      overflow: hidden;
    }

    /* Subtle pulse on hover */
    .step:hover {
      background:rgba(255,255,255,0.06);
      transform: scale(1.08);
      border-color: rgba(110,231,183,0.2);
      animation: stepPulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Active step state */
    .step.on{
      background: linear-gradient(135deg,#6ee7b7,#34d399);
      box-shadow:0 4px 16px rgba(46,185,128,0.25), 0 0 12px rgba(110,231,183,0.15);
      border-color: rgba(110,231,183,0.4);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* Active step hover with enhanced glow */
    .step.on:hover {
      box-shadow:0 6px 24px rgba(46,185,128,0.45), 0 0 20px rgba(110,231,183,0.3);
      transform: scale(1.1);
      animation: stepGlow 1.2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Progressive disclosure: show step number on hover */
    .step span {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:9px;
      font-weight:600;
      color:transparent;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }

    .step:hover span {
      color:rgba(255,255,255,0.5);
      font-size:10px;
    }

    .step.on span {
      color:rgba(15,20,22,0.6);
    }

    .step.on:hover span {
      color:rgba(15,20,22,0.8);
      font-size:11px;
    }

    /* Pulse animation for inactive steps */
    @keyframes stepPulse {
      0%, 100% {
        box-shadow: 0 0 0 rgba(110,231,183,0.1);
      }
      50% {
        box-shadow: 0 0 12px rgba(110,231,183,0.2), 0 0 4px rgba(110,231,183,0.15);
      }
    }

    /* Glow animation for active steps */
    @keyframes stepGlow {
      0%, 100% {
        box-shadow:0 6px 24px rgba(46,185,128,0.45), 0 0 20px rgba(110,231,183,0.3);
      }
      50% {
        box-shadow:0 8px 32px rgba(46,185,128,0.6), 0 0 28px rgba(110,231,183,0.45);
      }
    }

    /* Ripple effect on click */
    @keyframes ripple {
      from {
        transform: scale(0);
        opacity: 0.6;
      }
      to {
        transform: scale(2.5);
        opacity: 0;
      }
    }

    .step::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(110,231,183,0.6), transparent 70%);
      transform: scale(0);
      opacity: 0;
      pointer-events: none;
    }

    .step:active::after {
      animation: ripple 0.6s cubic-bezier(0, 0, 0.2, 1);
    }

    /* Keyboard focus state for accessibility */
    .step:focus-visible {
      outline: 2px solid rgba(110,231,183,0.6);
      outline-offset: 2px;
      transform: scale(1.06);
    }

    /* Icon and button enhancements */
    .icon-btn svg{
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      filter: drop-shadow(0 2px 8px rgba(110,231,183,0.15));
    }
    .icon-btn:hover svg{
      transform:translateY(-3px) scale(1.08);
      filter: drop-shadow(0 4px 12px rgba(110,231,183,0.3));
    }

    /* Button hover states */
    button {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
    }
    button:active:not(:disabled) {
      transform: translateY(0);
    }

    /* Primary accent button glow effect */
    #playBtn {
      box-shadow: 0 4px 16px rgba(110,231,183,0.2);
    }
    #playBtn:hover:not(:disabled) {
      box-shadow: 0 6px 24px rgba(110,231,183,0.35);
      transform: translateY(-2px);
    }

    /* Range slider enhancement */
    input[type="range"] {
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      height: 6px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ee7b7, #34d399);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(110,231,183,0.3);
      transition: all 0.2s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 12px rgba(110,231,183,0.5);
    }
    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6ee7b7, #34d399);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(110,231,183,0.3);
    }

    .muted{ color:#9fb1b0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:12px }

    /* Smooth fade-in animation for cards */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card {
      animation: fadeIn 0.4s ease-out backwards;
    }
    .card:nth-child(2) { animation-delay: 0.05s; }
    .card:nth-child(3) { animation-delay: 0.1s; }
    .card:nth-child(4) { animation-delay: 0.15s; }
    .card:nth-child(5) { animation-delay: 0.2s; }
  </style>
</head>
<body class="text-studio-100 min-h-screen">

  <header class="p-4 lg:p-6 flex flex-wrap items-center justify-between gap-4">
    <div class="flex items-center gap-2 md:gap-4">
      <!-- Logo (rings svg inline) -->
      <div class="p-2 md:p-3 rounded-lg card flex items-center gap-2 md:gap-3">
        <div class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center">
          <svg viewBox="0 0 48 48" class="w-6 h-6 md:w-8 md:h-8" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="24" cy="24" r="10" stroke="#6ee7b7" stroke-width="1.5" opacity="0.95"/>
            <circle cx="24" cy="24" r="16" stroke="#34d399" stroke-width="1.2" opacity="0.7"/>
            <circle cx="24" cy="24" r="22" stroke="#a7f3d0" stroke-width="0.9" opacity="0.45"/>
          </svg>
        </div>
        <div>
          <div class="text-sm md:text-base font-semibold tracking-tight">BeatGrid</div>
          <div class="text-xs muted hidden sm:block">Studio Edition — modular patterns</div>
        </div>
      </div>
      <nav class="hidden lg:flex gap-2 xl:gap-3 ml-2 xl:ml-4">
        <button id="seedRandom" class="px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">Randomize</button>
        <button id="formatClaude" class="px-3 py-1.5 rounded-lg text-sm bg-studio-800/40 hover:bg-studio-800/70 border border-studio-700/40">Format for LLM</button>
      </nav>
    </div>

    <div class="flex flex-wrap items-center gap-2 md:gap-3">
      <div class="flex items-center gap-2">
        <button id="playBtn" class="px-3 md:px-4 py-1.5 md:py-2 rounded-lg bg-accent border border-accent text-studio-900 font-semibold text-sm hover:bg-accent-600">▶ Play</button>
        <button id="stopBtn" class="px-3 md:px-4 py-1.5 md:py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted" disabled>■ Stop</button>
      </div>
      <div class="hidden sm:flex items-center gap-2 md:gap-3">
        <div class="text-right">
          <div class="text-xs muted">Tempo</div>
          <div class="font-semibold text-sm" id="tempoLabel">170 BPM</div>
        </div>
        <input id="tempo" type="range" min="160" max="180" value="170" class="w-32 md:w-40" />
      </div>
    </div>
  </header>

  <main class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- DRUMS -->
    <section id="drumCol" class="">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Drum Kits</h2>
        <div class="muted text-sm">2 bars — 32 steps</div>
      </div>
      <div id="drumGrid" class="grid grid-cols-1 gap-4"></div>
    </section>

    <!-- BASS -->
    <section id="bassCol" class="">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Bass & Rhythm</h2>
        <div class="muted text-sm">Hints / progressions</div>
      </div>
      <div id="bassGrid" class="grid grid-cols-1 gap-4"></div>
    </section>

    <!-- LEADS -->
    <section id="leadCol" class="">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Leads / Motifs</h2>
        <div class="muted text-sm">Scales • Degrees</div>
      </div>
      <div id="leadGrid" class="grid grid-cols-1 gap-4"></div>
    </section>
  </main>

  <footer class="p-4 lg:p-6 flex flex-col md:flex-row items-center justify-between gap-3 md:gap-4 border-t border-studio-700/20">
    <div class="text-xs md:text-sm muted tracking-wide">Loop • Listen • Recalibrate — studio motif</div>

    <!-- Desktop: Show all buttons -->
    <div class="hidden md:flex flex-wrap gap-2 justify-end">
      <button id="copySelection" class="px-3 py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted hover:bg-studio-800/70 hover:text-accent transition-colors">Copy Selected (LLM)</button>
      <button id="downloadSelection" class="px-3 py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted hover:bg-studio-800/70 hover:text-accent transition-colors">Download Selection</button>
      <button id="exportAll" class="px-3 py-2 rounded-lg bg-accent/10 border border-accent/30 text-accent text-sm hover:bg-accent/20 transition-colors">Export All</button>
      <button id="saveGist" class="px-3 py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted hover:bg-studio-800/70 transition-colors" title="Save to GitHub Gist">Save Gist</button>
      <button id="formatClaude" class="px-3 py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted hover:bg-studio-800/70 transition-colors">Format for LLM</button>
      <button id="clearSession" class="px-3 py-2 rounded-lg bg-studio-800/50 border border-studio-700/40 text-sm muted hover:bg-studio-800/70 hover:text-red-400 transition-colors" title="Clear saved session state">Clear Session</button>
    </div>

    <!-- Mobile: Export menu button -->
    <div class="md:hidden w-full">
      <button id="mobileExportBtn" class="w-full min-h-[44px] px-4 py-3 rounded-lg bg-accent/10 border border-accent/30 text-accent text-base font-medium hover:bg-accent/20 transition-colors flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        <span>Export & Actions</span>
      </button>
    </div>
  </footer>

  <!-- Mobile Export Menu (hidden by default) -->
  <div id="mobileExportMenu" class="fixed inset-0 bg-studio-900/95 backdrop-blur-sm z-50 hidden">
    <div class="flex flex-col h-full">
      <!-- Menu Header -->
      <div class="p-4 border-b border-studio-700/30 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Export & Actions</h3>
        <button id="closeMobileMenu" class="min-h-[44px] min-w-[44px] flex items-center justify-center rounded-lg hover:bg-studio-800/50 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Menu Content -->
      <div class="flex-1 overflow-y-auto p-4 space-y-3">
        <!-- Export Section -->
        <div class="space-y-2">
          <div class="text-xs font-semibold text-accent uppercase tracking-wider mb-3">Export Options</div>

          <button data-action="copySelection" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-left hover:bg-studio-800/70 hover:border-accent/30 transition-all flex items-center gap-3">
            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <div>
              <div class="font-medium">Copy Selected (LLM)</div>
              <div class="text-xs text-muted">Copy current selection as markdown</div>
            </div>
          </button>

          <button data-action="downloadSelection" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-left hover:bg-studio-800/70 hover:border-accent/30 transition-all flex items-center gap-3">
            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
            </svg>
            <div>
              <div class="font-medium">Download Selection</div>
              <div class="text-xs text-muted">Save selected patterns as JSON</div>
            </div>
          </button>

          <button data-action="exportAll" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-accent/10 border border-accent/30 text-accent text-left hover:bg-accent/20 transition-all flex items-center gap-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L9 8m4-4v12"/>
            </svg>
            <div>
              <div class="font-medium">Export All Patterns</div>
              <div class="text-xs opacity-75">Download complete pattern library</div>
            </div>
          </button>

          <button data-action="formatClaude" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-left hover:bg-studio-800/70 hover:border-accent/30 transition-all flex items-center gap-3">
            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <div>
              <div class="font-medium">Format for LLM</div>
              <div class="text-xs text-muted">Copy all patterns in LLM format</div>
            </div>
          </button>

          <button data-action="saveGist" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-left hover:bg-studio-800/70 hover:border-accent/30 transition-all flex items-center gap-3">
            <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
            </svg>
            <div>
              <div class="font-medium">Save to GitHub Gist</div>
              <div class="text-xs text-muted">Requires GitHub token</div>
            </div>
          </button>
        </div>

        <!-- Session Section -->
        <div class="space-y-2 pt-4 border-t border-studio-700/30">
          <div class="text-xs font-semibold text-muted uppercase tracking-wider mb-3">Session</div>

          <button data-action="clearSession" class="mobile-menu-btn w-full min-h-[52px] px-4 py-3 rounded-lg bg-studio-800/50 border border-studio-700/40 text-left hover:bg-studio-800/70 hover:border-red-400/30 hover:text-red-400 transition-all flex items-center gap-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            <div>
              <div class="font-medium">Clear Session</div>
              <div class="text-xs text-muted">Reset all selections and tempo</div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS modules -->
  <script type="module">
    import { drums, basses, leads } from './js/data.js';
    import { icons } from './js/icons.js';
    import { renderApp } from './js/app.js';

    // expose data to app
    renderApp({ drums, basses, leads, icons });
  </script>
</body>
</html>